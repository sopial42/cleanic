name: Test - data extract
version: '2'

testcases:
  - name: reset db
    steps:
      - type: dbfixtures
        database: postgres
        dsn: "{{ .pgsql_dsn }}"
        migrations: ../testData/schemas/
        folder: ../testData/fixtures/patient
        retry: 10
  - name: list all existing patients
    steps:
      - type: http
        method: GET
        url: "{{.url}}/patients"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldHaveLength 2
          - result.bodyjson.__Type__ ShouldEqual Array
          - result.bodyjson.bodyjson0.id ShouldEqual 10001
          - result.bodyjson.bodyjson0.firstname ShouldEqual John
          - result.bodyjson.bodyjson0.lastname ShouldEqual Doe
          - result.bodyjson.bodyjson0.email ShouldEqual jd@gmail.com
          - result.bodyjson.bodyjson1.id ShouldEqual 10002
          - result.bodyjson.bodyjson1.firstname ShouldEqual Jeanne
          - result.bodyjson.bodyjson1.lastname ShouldEqual Scred
          - result.bodyjson.bodyjson1.email ShouldEqual js@gmail.com
